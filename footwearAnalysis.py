from scrapy.crawler import CrawlerProcess
from pymongo import MongoClient
import datetime
import pandas as pd
import numpy as np
import re
from itertools import repeat
import matplotlib.mlab as mlab
import matplotlib.pyplot as plt

##### Connect to MongoDB database#######################################
client = MongoClient('localhost')
db = client['jdScraping']
products = db['products']
########################################################################

dfAll = pd.DataFrame.from_records(products.find())
print(np.unique(dfAll['dateTimeOfScrape']))
#dfAll = dfAll.drop_duplicates('name')
dfAll['brand'] = dfAll['brand'].str.replace('adidas Originals', 'adidas')
dfAll[['category1','category2','category3','category4']] = pd.DataFrame(dfAll.categories.values.tolist(), index= dfAll.index)
dfAll['storePrice'] = pd.to_numeric(dfAll['storePrice'])
result = dfAll.groupby('category2', as_index=False)['storePrice'].count()
#result.to_csv('C:\\temp\\footwear2.csv')
print(result)
'''nike = dfAll[dfAll['brand']=='adidas'].copy()
print(len(nike))
print(dfAll['storePrice'].mean())
result = dfAll.groupby('brand', as_index=False)['storePrice'].mean()
result.to_csv('C:\\temp\\footwear.csv')'''



'''bins = [0,15,30,45,60,75,90,105,120,135,150]
fig, ax1 = plt.subplots()
ax1.hist(nike['storePrice'], bins, alpha = 0.6, edgecolor='black', linewidth=0.5)
y_vals = ax1.get_yticks()
ax1.set_yticklabels(['{:3.0f}%'.format(x / 699 *100) for x in y_vals])
plt.show()'''

#84.9984.9984.9972.9972.9947.9947.99104.9979.9979.9979.9979.9967.9967.9959.9959.9959.9942.9942.9942.9952.9939.9939.9959.9947.9947.9942.9934.9934.9967.9958.0047.9942.0042.0033.0031.0031.0031.0025.0025.0025.0025.0042.0054.9964.9933.0037.9933.0047.9937.9939.0044.9939.0024.5042.0042.0030.0044.0048.0038.0021.0030.0024.5042.0048.0056.9951.9967.0039.5063.0030.5056.9950.0033.0062.0079.9933.0038.0044.0037.9931.9954.9984.9984.9969.9953.0053.0056.9931.0035.0053.0050.0053.0056.9956.9942.9964.9969.9964.9999.9944.9984.9956.9951.99104.9964.9937.9959.99119.99104.9951.9942.9955.0054.9937.0037.0056.9951.9939.9926.0028.0031.9931.9954.9944.9932.0026.0033.0025.0024.9920.0034.9922.0049.9934.9924.9922.0020.0025.9937.9920.0031.9927.9918.0036.9936.9931.9934.9927.9949.9918.0022.0023.0024.9939.9922.0021.9934.9931.9944.9928.0034.9934.9922.0025.9922.0020.0024.9937.9931.9936.9923.0038.0031.9943.0024.0033.0026.0058.0055.0040.0040.0033.0047.9946.0046.0046.0033.0033.0038.0037.9933.0024.0033.0032.0032.0032.0022.0031.0031.0028.0027.9918.0023.0033.0033.0024.0033.0027.0026.0095.0095.0085.0058.0055.0055.0042.0031.0031.0031.0080.0040.0050.0058.0058.0058.0058.0055.0055.0043.0039.0064.9953.0060.0039.0053.0059.9953.0059.0034.5055.0057.0048.0074.0046.0052.0046.0056.9935.0099.9989.9948.0044.9951.9951.9951.9964.99114.9944.9940.0024.5033.0019.0040.0033.0033.0024.0020.0020.0024.0017.0033.0031.0031.0020.0019.0018.0018.5025.0015.0024.0023.0012.0048.0024.0033.0030.0025.0022.0020.0031.0027.9940.0027.9927.9931.9932.0034.9939.9954.9939.9964.9954.9949.9969.9954.9937.9937.9942.9939.9944.9954.9937.9931.9924.9929.9947.0057.0048.0059.0051.9939.0048.0048.0033.0046.0046.5062.0053.0063.0059.0059.0040.0035.0050.0073.00105.0073.0040.0040.0040.0040.0055.0051.9933.0046.0042.0042.0042.0024.0038.0034.9933.0033.0031.0031.0031.00100.0040.0040.0056.0033.0034.0064.9979.9967.9964.9964.9954.9964.9959.9964.9959.9964.9979.9954.9947.9954.9937.9930.0034.9920.0020.0031.0022.0017.0019.0024.0039.5018.0026.0023.0026.0023.0032.0030.0021.5018.0023.0014.0023.0020.0020.0030.0018.5024.0017.0014.0014.0016.5020.0020.0019.0017.0035.0024.0025.0029.9929.9929.9947.9926.9922.9924.9926.9934.9924.9923.9925.0039.9922.0046.0089.9956.0035.0089.9948.0053.0033.0040.0055.0055.0033.0033.0071.0040.0040.0033.0040.0040.0033.0024.0020.0033.0031.0031.0030.00125.0047.9947.9952.9952.9959.9964.9935.0054.9924.0017.0023.0020.0020.0026.0024.0019.0018.0064.9994.9940.0030.0021.5020.0031.0031.0042.0034.9931.0048.0047.9930.0034.9939.9923.0014.0059.9934.3629.0021.9917.0027.9945.0074.9940.0033.0075.0044.00100.0031.5043.4531.5035.0039.5039.5048.0031.5038.0032.0032.0030.0025.0031.5071.0035.0032.0030.0028.0023.0023.0016.0019.9928.0029.9919.0020.0039.9928.0023.0033.0039.9937.9919.0023.0031.9938.0046.0050.0057.0039.0033.0099.9994.9994.9964.9969.9964.9964.9960.0057.0057.0051.9950.0042.0031.5095.0042.0035.0035.0030.0054.0054.0033.0039.9925.0029.0028.0033.0028.0032.0034.9929.0022.0028.0031.0025.9928.0026.9920.0025.9917.5023.0034.9927.9932.0027.9925.9933.0025.9927.9917.9925.9922.0022.0032.0032.0030.0050.0042.0046.0032.0035.0046.0016.0019.0051.9959.9939.9939.9924.9921.9928.0022.0031.9928.0016.0016.0022.0017.9919.9932.9925.9919.9933.0038.0024.9952.0039.0021.9946.0042.0048.0039.0037.9947.9921.9925.9925.9928.0019.0027.9928.0031.0026.0072.0072.0050.0044.9972.0039.0058.0039.0033.0050.0046.0048.0021.9921.9924.9921.0018.0039.0027.0032.0025.0023.0032.0031.0031.0027.0028.0014.0026.0029.0032.0032.0023.0031.0028.0046.0052.0055.0067.0046.0033.0051.9930.0048.0048.0040.0031.0021.9923.0039.0026.0028.0026.0035.0037.0036.9939.9914.0019.0017.0032.0046.0016.5027.0031.0025.0017.5028.0012.0024.5027.0039.0055.0048.0048.0055.0042.0062.0062.0068.0046.0067.0081.0063.0046.0039.9914.0019.0031.0039.0042.0023.0032.0017.5025.0016.0029.0021.9917.0027.0031.0031.0023.0055.0064.9963.0032.0038.0031.5075.0039.0049.0046.0063.0062.0036.0019.0023.0034.9917.0012.0019.9923.0031.0023.0025.0032.0032.0019.0027.0035.0016.5022.0022.0027.0039.0042.0014.0029.0046.0037.0034.0031.0033.0038.0027.0027.5033.0020.0025.0025.0029.0029.0027.9925.9914.0014.0019.0037.9939.0071.9946.0045.0030.0055.0033.0016.0027.9917.0015.0023.0025.0029.0034.5065.0048.0033.0016.0025.0030.0012.0016.5032.009.0031.9921.9924.0019.0029.0014.0023.0016.5023.0030.0025.9919.0062.0042.0055.0035.0040.0032.0046.0044.9946.0026.0025.9929.0028.0023.0032.9923.0032.0021.0016.5022.5016.0023.0027.9921.0017.0021.0019.5016.0023.0016.5016.0029.0039.0017.5025.0028.0022.5030.0018.5025.0016.5032.0028.0015.0021.0017.0048.0035.0034.5046.0031.5033.0030.0019.5016.5026.0025.0030.0021.0025.9930.0021.9916.5039.0028.0021.0026.0019.5023.0019.0030.0031.9953.0042.0042.0046.0016.0023.0015.0035.0034.5024.0042.0067.0022.0039.0030.0013.5018.0020.0020.0022.0035.0032.0046.0062.0035.0036.9935.0042.0039.0042.0032.0042.0035.0036.9926.0047.9932.0035.0047.9964.9930.0013.9931.9919.9931.9931.9937.9929.9924.9921.9934.9934.9936.9939.9959.9969.9942.0055.0038.0079.9959.0079.9917.9927.9947.9984.9927.9923.0025.0031.9931.9921.9929.9926.9926.9917.9925.9926.0037.9924.9926.0029.0028.0027.9923.0042.9922.0042.9920.0039.9923.0023.0011.0019.9917.9924.9979.9926.0047.9962.9942.9921.9911.0018.5017.0022.9914.0016.5021.9921.9912.0049.9937.9939.9913.9937.9916.0031.9919.0027.9935.0045.0022.0082.1155.0062.0046.0039.0059.9933.0064.999.5032.0020.0013.0022.0012.5028.0018.0023.0013.0020.0016.0051.0016.0023.0020.0024.0020.0069.9969.9918.0034.9922.0069.9947.0014.0020.0032.0059.9954.9969.9939.0039.0033.0025.0042.0031.0028.0047.9917.0026.0026.0054.9933.5047.9946.0027.5044.9931.0079.9954.9939.9929.009.9910.9913.9917.9913.9917.9914.9914.9921.9917.9912.5016.0025.9924.9918.5033.0023.0042.9916.0048.0048.0025.0025.0031.0033.0014.0013.0047.9934.5038.0048.0024.0028.0028.0018.0029.9922.0017.5033.0016.0024.0031.9924.0022.0019.0032.0028.0026.0028.0015.0027.9917.9917.9925.0028.0031.9937.9919.9914.0012.0010.5024.9923.0019.0015.0012.0013.5024.0024.0033.0046.0051.9923.0039.9954.9942.0023.0033.0026.9935.0016.0034.9948.0014.0047.9953.0039.0070.0042.9941.0054.9945.0044.9954.9944.9938.0045.0024.0069.9947.9969.9933.0038.0031.0031.0029.0045.0010.9924.9936.9915.0010.5016.9918.5018.9918.5020.0012.5018.0020.0026.0016.0019.0028.0026.0033.0028.0017.009.0021.9913.0013.0018.0019.0015.0022.0017.9962.0060.0067.9939.0050.0057.0042.0022.0021.9913.0028.0021.9919.9942.0048.0010.0017.5039.0027.0025.0038.0011.9932.0018.9911.0031.9914.0030.0018.5023.0010.0028.5022.0035.9925.0026.0015.0035.9919.0027.0025.0020.0033.0044.0044.9939.0030.0037.9929.0059.9924.0021.0042.0038.0029.0042.0046.0038.0045.0038.0036.0070.0010.508.4910.507.5011.007.0056.0069.9963.5015.0026.9932.1120.0031.9939.0044.9939.0055.0042.0030.0019.0023.0016.0017.5028.0024.0090.0055.0090.0045.0046.0059.9924.0054.9926.9926.0079.9967.9927.0054.9947.9926.0031.9919.0023.0021.0019.0031.9927.0019.0018.0029.9939.9918.9937.9914.0031.9927.0023.0014.0016.5017.0015.0021.9916.008.0010.507.5010.5014.9910.5010.506.507.007.0010.5045.0070.0042.9923.0022.0025.0023.9926.9934.9937.9930.0028.0072.0030.0033.0038.0016.5023.0015.0033.0017.5019.0012.0031.0014.0027.0025.0017.5021.9923.0023.0054.9939.0019.0019.5038.0031.9930.0030.0031.9930.0032.0035.0057.0025.9959.9959.9974.9952.0053.0010.509.006.5024.996.505.007.007.0010.5034.9916.5018.0015.0018.0025.0028.0015.0024.0031.0046.0062.0024.0022.0023.0019.0038.0023.0019.0032.0055.0019.5016.0032.0028.5039.0017.9914.008.007.507.507.507.0010.508.004.509.007.008.004.5012.9913.009.0030.0035.0050.0069.9928.0059.9948.0064.9964.9934.9925.0021.9925.0028.0035.0017.0027.0052.0022.0028.0027.0019.0014.0035.009.005.506.5010.505.0010.5016.5015.007.5010.0015.005.5013.996.006.5010.508.4910.0012.007.5033.0055.0016.0028.0028.0016.5025.0039.0032.0029.0022.0037.9929.0018.0039.0046.0053.0037.5014.0015.997.5011.0013.007.505.5017.006.507.505.507.5010.507.507.005.0055.0045.0065.0042.0032.0018.0031.9923.0057.0025.0015.0013.0015.0024.5024.0024.0038.0025.0059.9910.5014.0015.006.509.0011.5010.509.009.009.5069.9948.0044.0060.0040.0039.0043.0016.0010.5024.0037.9914.0037.9925.0059.9931.9920.0011.997.507.5015.007.5013.0010.5014.997.5018.0010.5013.997.509.0028.0018.006.509.0053.0042.007.5014.0014.0016.9931.9929.9942.0025.007.0010.507.5012.9910.0012.0025.9925.995.5010.507.5010.5021.997.5032.0017.0028.0011.5019.0014.995.5025.009.0010.0018.0011.006.0024.999.007.005.0015.0021.9937.9919.9932.1124.0019.0026.9918.0042.9914.0031.9910.5013.9912.9915.007.50159.9916.0052.0035.9952.0020.0030.0017.0019.0030.0048.0067.9935.9916.0026.0037.9965.0032.0014.0067.9945.0037.9964.9929.997.5018.0012.0015.9913.9917.9922.0011.5014.997.5050.0026.0012.0020.006.5018.0012.997.509.0017.9917.9915.005.5022.009.007.509.009.0037.998.0017.9917.9919.009.009.0014.995.009.0035.9911.0013.9913.997.509.009.0021.9914.9911.009.0017.9914.9935.9914.9910.5014.007.0011.0017.9913.0010.5029.9926.0019.9916.0015.0010.5011.0015.0015.007.009.0018.0012.0015.0013.0014.0031.9916.9916.9918.0024.0018.0013.0016.5017.0042.9915.0021.9912.5024.9917.0014.0024.9914.0016.9915.0037.9931.9916.9915.0027.5024.0024.0031.9942.9925.0021.0021.9914.0019.9914.0011.0010.5036.9919.0022.0028.5018.0024.0015.0017.5032.0016.9916.9916.9917.5016.9922.0012.0025.0014.0021.9917.9917.5026.9917.5047.9926.9921.9957.0028.0016.9914.0031.9928.0017.5025.0034.9926.9924.0047.9914.0031.9926.9921.9936.9946.0019.9919.9914.0014.00